# generated by datamodel-codegen:
#   filename:  open-api-spec.yaml

from __future__ import annotations

from datetime import datetime
from enum import Enum
from typing import List, Optional, Union

from pydantic import AnyUrl, BaseModel, Field


class Kind(Enum):
    cex = 'cex'
    dex = 'dex'
    perp = 'perp'
    options = 'options'
    aggregator = 'aggregator'
    other = 'other'


class Exchange(BaseModel):
    id: str = Field(
        ...,
        description='Stable identifier for the exchange (used as map key)',
        examples=['derive', 'thalex', 'cow', 'uniswap_v3'],
    )
    name: str = Field(..., examples=['Derive', 'Thalex', 'CoW Protocol'])
    kind: Kind = Field(..., example='perp')
    chain: Optional[str] = Field(
        None, description='Chain if on-chain, null for off-chain venues', example='base'
    )
    website: Optional[AnyUrl] = None


class TimeSeriesPoint(BaseModel):
    timestamp: datetime
    value: float


class VolumesSeriesPoint(BaseModel):
    exchange_id: str = Field(
        ...,
        description='Exchange identifier this data point belongs to',
        examples=['derive', 'thalex', 'cow', 'uniswap_v3'],
    )
    total_volume: float = Field(
        ..., description='Total volume on venue over the window'
    )
    derolas_volume: float = Field(
        ..., description='Volume generated by Derolas over the window'
    )
    derolas_volume_share_pct: float = Field(
        ..., description='Percentage of venue volume that is Derolas (0–100)'
    )
    timestamp_start: datetime = Field(
        ..., description='Start of the time window (inclusive)'
    )
    timestamp_end: datetime = Field(
        ..., description='End of the time window (exclusive)'
    )


class Series(BaseModel):
    pass


class VolumesResponse(BaseModel):
    series: Union[List[VolumesSeriesPoint], Series] = Field(
        ..., description='Flat list of points (each point includes exchange_id)'
    )


class PoolSummary(BaseModel):
    id: str
    name: str
    chain: str = Field(..., example='base')
    address: str = Field(..., description='On-chain pool address')
    symbol: Optional[str] = Field(None, description='Pool symbol / ticker')


class AssetRoiSeries(BaseModel):
    asset_symbol: str = Field(..., example='wETH')
    series: List[TimeSeriesPoint] = Field(
        ..., description='Cumulative ROI (%) over time for this asset'
    )


class PoolMetricsResponse(BaseModel):
    pool_id: str
    current_apr: float = Field(
        ..., description='Current APR (percentage, 0–100)', example=0.54
    )
    fees_24h_usd: float = Field(..., example=1.54)
    total_shares: float = Field(..., example=200.38)
    tvl_usd: float = Field(
        ..., description='Current total value locked', example=104497.48
    )
    current_share_price_usd: float = Field(..., example=521.49)
    current_roi_pct: float = Field(
        ..., description='Current ROI in percent (may be negative)', example=-14.88
    )
    share_price_series: List[TimeSeriesPoint] = Field(
        ..., description='For "Derolas Share Price" chart'
    )
    asset_cumulative_roi_series: List[AssetRoiSeries] = Field(
        ..., description='For "Cumulative ROI of Assets in Bundle" multi-line chart'
    )
    tvl_series: List[TimeSeriesPoint] = Field(
        ..., description='TVL (USD) over previous 30 days'
    )
    fees_series: List[TimeSeriesPoint] = Field(
        ..., description='Fees (USD) over previous 30 days'
    )
    lp_shares_series: List[TimeSeriesPoint] = Field(
        ..., description='Derolas LP shares over previous 30 days'
    )


class ExchangesResponse(BaseModel):
    exchanges: List[Exchange]


class PoolsResponse(BaseModel):
    pools: List[PoolSummary]
